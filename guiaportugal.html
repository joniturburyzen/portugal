<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üó∫Ô∏è Planificador de Rutas - Portugal</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: white;
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #667eea);
            background-size: 400% 100%;
            animation: gradientShift 8s ease infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        h1 {
            color: #667eea;
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .subtitle {
            color: #666;
            font-size: 1.3em;
            margin-top: 10px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .form-section {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .form-group {
            margin-bottom: 30px;
        }

        label {
            display: block;
            margin-bottom: 12px;
            font-weight: 700;
            color: #555;
            font-size: 1.15em;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        label i {
            color: #667eea;
            font-size: 1.4em;
        }

        select {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            background: #fafafa;
            font-weight: 600;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
            background: white;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px 36px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
            font-weight: 700;
            transition: all 0.3s;
            margin-top: 10px;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 1.1em;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.7);
        }

        .btn:active {
            transform: translateY(0);
        }

        .map-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        #map {
            height: 500px;
            width: 100%;
            border-radius: 12px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .results-section {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-top: 30px;
            display: none;
        }

        .results-section.active {
            display: block;
            animation: fadeInUp 0.6s ease;
        }

        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(30px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        .results-title {
            color: #667eea;
            font-size: 2.3em;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            padding-bottom: 15px;
        }

        .results-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 5px;
            background: #667eea;
            border-radius: 2px;
        }

        /* Road Trip Route Design */
        .route-summary {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 40px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            position: relative;
            border: 2px solid #667eea;
        }

        .route-title {
            text-align: center;
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 30px;
            font-weight: 700;
        }

        .road-trip-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            padding: 30px 0;
            margin: 20px 0;
        }

        /* L√≠nea curva road trip */
        .road-trip-container::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 5%;
            right: 5%;
            height: 4px;
            background: linear-gradient(90deg, 
                #667eea 0%, 
                #764ba2 25%, 
                #f093fb 50%, 
                #764ba2 75%, 
                #667eea 100%);
            border-radius: 2px;
            transform: translateY(-50%);
            z-index: 1;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
        }

        /* L√≠nea curva decorativa encima */
        .road-trip-container::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 5%;
            right: 5%;
            height: 2px;
            background: white;
            border-radius: 2px;
            transform: translateY(-50%);
            z-index: 2;
            opacity: 0.5;
        }

        .route-point {
            position: relative;
            z-index: 10;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            width: 180px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .route-point:hover {
            transform: translateY(-10px) scale(1.05);
        }

        .route-point.active {
            transform: scale(1.15) translateY(-15px);
            z-index: 20;
            filter: drop-shadow(0 10px 20px rgba(102, 126, 234, 0.5));
        }

        .route-point.active::before {
            content: '';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 6px;
            background: linear-gradient(90deg, transparent, #ffd700, transparent);
            border-radius: 3px;
        }

        .point-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 15px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.4s ease;
        }

        .point-icon.start {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .point-icon.stop {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .point-icon.end {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .point-label {
            font-weight: 700;
            font-size: 1.1em;
            margin-bottom: 8px;
            color: #555;
        }

        .point-name {
            font-weight: 600;
            font-size: 1.3em;
            color: #667eea;
            margin-bottom: 10px;
            min-height: 30px;
        }

        .distance-info {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 700;
            color: #667eea;
            box-shadow: 0 3px 10px rgba(0,0,0,0.15);
            font-size: 1.1em;
            z-index: 5;
        }

        .distance-info.first {
            left: 25%;
        }

        .distance-info.second {
            right: 25%;
        }

        /* Loading animation */
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.3em;
            display: none;
        }

        .loading.active {
            display: block;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Recommendations Panel */
        .recommendations-panel {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 35px;
            border-radius: 15px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: none;
        }

        .recommendations-panel.active {
            display: block;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from { 
                opacity: 0; 
                transform: translateY(-20px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        .panel-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        .panel-header h3 {
            font-size: 2em;
            color: #667eea;
            margin-bottom: 10px;
        }

        .panel-header .city-name {
            font-size: 1.5em;
            color: #555;
            font-weight: 600;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
        }

        .recommendation-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.4s ease;
            position: relative;
            height: 280px;
        }

        .recommendation-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            transition: transform 0.6s;
            padding: 25px;
            display: flex;
            flex-direction: column;
        }

        .card-front {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .card-back {
            background: white;
            color: #333;
            transform: rotateY(180deg);
        }

        .recommendation-card.flipped .card-front {
            transform: rotateY(180deg);
        }

        .recommendation-card.flipped .card-back {
            transform: rotateY(0deg);
        }

        .card-front .card-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .card-front .card-title {
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 15px;
            min-height: 60px;
        }

        .card-front .card-category {
            font-size: 0.95em;
            opacity: 0.9;
            margin-top: 10px;
        }

        .card-back .card-description {
            color: #666;
            line-height: 1.7;
            margin-bottom: 15px;
            flex-grow: 1;
        }

        .card-back .card-contact {
            background: #f0f4f8;
            padding: 12px 15px;
            border-radius: 8px;
            font-weight: 600;
            color: #1976d2;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            border-left: 4px solid #667eea;
        }

        .card-back .card-price {
            background: #fff3e0;
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: 600;
            color: #e65100;
            display: inline-block;
            margin-top: 8px;
        }

        .cultural-card .card-front {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .restaurant-card .card-front {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .copy-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }

        footer {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .recommendations-grid {
                grid-template-columns: 1fr;
            }
            
            .road-trip-container {
                flex-direction: column;
                gap: 30px;
            }
            
            .road-trip-container::before {
                content: none;
            }
            
            .road-trip-container::after {
                content: none;
            }
            
            .distance-info {
                position: static;
                transform: none;
                margin-top: 10px;
                width: 100%;
                text-align: center;
            }
            
            .route-point {
                width: 100%;
            }
            
            h1 {
                font-size: 2.3em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üó∫Ô∏è Planificador de Rutas por Portugal</h1>
            <p class="subtitle">Descubre Portugal con una parada intermedia culturalmente relevante</p>
        </header>

        <div class="main-content">
            <div class="form-section">
                <div class="form-group">
                    <label for="startPoint"><i class="fas fa-map-marker-alt"></i> üìç Ciudad de Salida</label>
                    <select id="startPoint">
                        <option value="">Selecciona una ciudad...</option>
                        <option value="lisboa">Lisboa</option>
                        <option value="porto">Oporto</option>
                        <option value="faro">Faro</option>
                        <option value="coimbra">Coimbra</option>
                        <option value="braga">Braga</option>
                        <option value="evora">√âvora</option>
                        <option value="aveiro">Aveiro</option>
                        <option value="setubal">Set√∫bal</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="endPoint"><i class="fas fa-flag-checkered"></i> üéØ Ciudad de Llegada</label>
                    <select id="endPoint">
                        <option value="">Selecciona una ciudad...</option>
                        <option value="lisboa">Lisboa</option>
                        <option value="porto">Oporto</option>
                        <option value="faro">Faro</option>
                        <option value="coimbra">Coimbra</option>
                        <option value="braga">Braga</option>
                        <option value="evora">√âvora</option>
                        <option value="aveiro">Aveiro</option>
                        <option value="setubal">Set√∫bal</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="middleStop"><i class="fas fa-stop-circle"></i> üè® Parada Intermedia (opcional)</label>
                    <select id="middleStop">
                        <option value="">Sin parada intermedia</option>
                        <!-- Se llenar√° din√°micamente -->
                    </select>
                </div>

                <button class="btn" id="generateRouteBtn"><i class="fas fa-magic"></i> üöÄ Generar Ruta y Recomendaciones</button>
            </div>

            <div class="map-section">
                <div class="map-header">
                    <h2 style="color: #667eea; margin: 0;"><i class="fas fa-map"></i> üó∫Ô∏è Tu Ruta en el Mapa</h2>
                </div>
                <div id="map"></div>
            </div>
        </div>

        <div class="results-section" id="resultsSection">
            <h2 class="results-title">‚ú® Tu Ruta Personalizada</h2>
            
            <div class="route-summary">
                <h3 class="route-title"><i class="fas fa-road"></i> üõ£Ô∏è Resumen de tu Road Trip</h3>
                <div class="road-trip-container">
                    <div class="route-point" data-index="0" id="pointStart">
                        <div class="point-icon start">üöÄ</div>
                        <div class="point-label">Salida</div>
                        <div class="point-name" id="nameStart">-</div>
                    </div>
                    
                    <div class="distance-info first" id="distance1">-</div>
                    
                    <div class="route-point" data-index="1" id="pointMiddle">
                        <div class="point-icon stop">üè®</div>
                        <div class="point-label">Parada</div>
                        <div class="point-name" id="nameMiddle">-</div>
                    </div>
                    
                    <div class="distance-info second" id="distance2">-</div>
                    
                    <div class="route-point" data-index="2" id="pointEnd">
                        <div class="point-icon end">üèÅ</div>
                        <div class="point-label">Llegada</div>
                        <div class="point-name" id="nameEnd">-</div>
                    </div>
                </div>
            </div>

            <div class="loading" id="loading">
                <i class="fas fa-spinner fa-spin"></i> Generando recomendaciones...
            </div>

            <div class="recommendations-panel" id="recommendationsPanel">
                <div class="panel-header">
                    <h3><i class="fas fa-star"></i> üåü Recomendaciones para</h3>
                    <div class="city-name" id="panelCityName">-</div>
                </div>
                
                <div class="recommendations-grid" id="recommendationsGrid">
                    <!-- Se llenar√° din√°micamente -->
                </div>
            </div>
        </div>

        <footer>
            <p>¬© 2026 Planificador de Rutas Tur√≠sticas de Portugal | Tu gu√≠a perfecta para explorar Portugal</p>
            <p style="margin-top: 10px; color: #666; font-size: 0.9em;">Aplicaci√≥n desarrollada con Leaflet y OpenStreetMap</p>
        </footer>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Base de datos de ciudades con coordenadas
        const cities = {
            lisboa: { name: "Lisboa", lat: 38.7223, lng: -9.1393, type: "ciudad" },
            porto: { name: "Oporto", lat: 41.1579, lng: -8.6291, type: "ciudad" },
            faro: { name: "Faro", lat: 37.0193, lng: -7.9304, type: "ciudad" },
            coimbra: { name: "Coimbra", lat: 40.2033, lng: -8.4103, type: "ciudad" },
            braga: { name: "Braga", lat: 41.5454, lng: -8.4265, type: "ciudad" },
            evora: { name: "√âvora", lat: 38.5715, lng: -7.9093, type: "ciudad" },
            aveiro: { name: "Aveiro", lat: 40.6405, lng: -8.6537, type: "ciudad" },
            setubal: { name: "Set√∫bal", lat: 38.5243, lng: -8.8926, type: "ciudad" },
            sintra: { name: "Sintra", lat: 38.7987, lng: -9.3883, type: "pueblo medieval" },
            obidos: { name: "√ìbidos", lat: 39.3583, lng: -9.1569, type: "pueblo medieval" },
            nazare: { name: "Nazar√©", lat: 39.6053, lng: -9.0722, type: "pueblo pesquero" },
            fatima: { name: "F√°tima", lat: 39.6250, lng: -8.6667, type: "lugar religioso" },
            tomar: { name: "Tomar", lat: 39.6000, lng: -8.4086, type: "patrimonio UNESCO" },
            guimaraes: { name: "Guimar√£es", lat: 41.4450, lng: -8.2900, type: "patrimonio UNESCO" },
            viseu: { name: "Viseu", lat: 40.6566, lng: -7.9139, type: "ciudad hist√≥rica" },
            guarda: { name: "Guarda", lat: 40.5389, lng: -7.2684, type: "ciudad hist√≥rica" },
            cascais: { name: "Cascais", lat: 38.7031, lng: -9.4233, type: "pueblo costero" },
            sesimbra: { name: "Sesimbra", lat: 38.4428, lng: -9.1061, type: "pueblo costero" },
            peniche: { name: "Peniche", lat: 39.3667, lng: -9.3833, type: "pueblo pesquero" },
            batalha: { name: "Batalha", lat: 39.6567, lng: -8.8181, type: "patrimonio UNESCO" },
            alcobaca: { name: "Alcoba√ßa", lat: 39.5531, lng: -8.9758, type: "patrimonio UNESCO" },
            conimbriga: { name: "Con√≠mbriga", lat: 40.1106, lng: -8.4911, type: "sitio arqueol√≥gico" },
            marvao: { name: "Marv√£o", lat: 39.3917, lng: -7.3903, type: "pueblo medieval" },
            monsaraz: { name: "Monsaraz", lat: 38.3953, lng: -7.3836, type: "pueblo medieval" },
            sortelha: { name: "Sortelha", lat: 40.4667, lng: -7.3833, type: "aldea hist√≥rica" },
            marialva: { name: "Marialva", lat: 40.8833, lng: -7.3167, type: "aldea hist√≥rica" },
            castelo_rodrigo: { name: "Castelo Rodrigo", lat: 40.8167, lng: -6.9833, type: "aldea hist√≥rica" },
            linhares: { name: "Linhares da Beira", lat: 40.4500, lng: -7.5833, type: "aldea hist√≥rica" },
            pinhel: { name: "Pinhel", lat: 40.6167, lng: -7.0667, type: "aldea hist√≥rica" },
            trancoso: { name: "Trancoso", lat: 40.7833, lng: -7.3833, type: "aldea hist√≥rica" },
            belmonte: { name: "Belmonte", lat: 40.0833, lng: -7.3667, type: "pueblo jud√≠o" },
            monsanto: { name: "Monsanto", lat: 39.7833, lng: -7.5167, type: "aldea hist√≥rica" },
            estremoz: { name: "Estremoz", lat: 38.8472, lng: -7.5917, type: "ciudad hist√≥rica" },
            vila_vicosa: { name: "Vila Vi√ßosa", lat: 38.7667, lng: -7.4167, type: "pueblo renacentista" },
            borba: { name: "Borba", lat: 38.7833, lng: -7.5167, type: "pueblo del vino" },
            redondo: { name: "Redondo", lat: 38.6167, lng: -7.5833, type: "pueblo del vino" },
            portalegre: { name: "Portalegre", lat: 39.2942, lng: -7.4319, type: "ciudad hist√≥rica" },
            elvas: { name: "Elvas", lat: 38.8833, lng: -7.1667, type: "patrimonio UNESCO" },
            santarem: { name: "Santar√©m", lat: 39.2333, lng: -8.6833, type: "ciudad hist√≥rica" },
            figueira_foz: { name: "Figueira da Foz", lat: 40.1528, lng: -8.8583, type: "pueblo costero" },
            ilhavo: { name: "√çlhavo", lat: 40.5833, lng: -8.6500, type: "pueblo pesquero" },
            costa_nova: { name: "Costa Nova", lat: 40.6333, lng: -8.7333, type: "playa" },
            espinho: { name: "Espinho", lat: 41.0000, lng: -8.6500, type: "pueblo costero" },
            vila_nova_gaia: { name: "Vila Nova de Gaia", lat: 41.1333, lng: -8.6167, type: "ciudad" },
            matosinhos: { name: "Matosinhos", lat: 41.1833, lng: -8.6833, type: "pueblo pesquero" },
            povoa_varzim: { name: "P√≥voa de Varzim", lat: 41.3833, lng: -8.7667, type: "pueblo costero" },
            barcelos: { name: "Barcelos", lat: 41.5333, lng: -8.6167, type: "ciudad hist√≥rica" },
            viana_castelo: { name: "Viana do Castelo", lat: 41.6917, lng: -8.8333, type: "ciudad hist√≥rica" },
            ponte_lima: { name: "Ponte de Lima", lat: 41.7667, lng: -8.5833, type: "aldea hist√≥rica" },
            valenca: { name: "Valen√ßa", lat: 42.0167, lng: -8.6333, type: "ciudad fortificada" },
            chaves: { name: "Chaves", lat: 41.7333, lng: -7.4500, type: "ciudad termal" },
            braganca: { name: "Bragan√ßa", lat: 41.8056, lng: -6.7564, type: "ciudad hist√≥rica" },
            miranda_douro: { name: "Miranda do Douro", lat: 41.4833, lng: -6.2833, type: "ciudad hist√≥rica" },
            mogadouro: { name: "Mogadouro", lat: 41.5667, lng: -6.7167, type: "pueblo hist√≥rico" },
            torre_moncorvo: { name: "Torre de Moncorvo", lat: 41.3167, lng: -7.2667, type: "pueblo del vino" },
            vila_flor: { name: "Vila Flor", lat: 41.2833, lng: -7.3667, type: "pueblo hist√≥rico" },
            carrazeda_ansiao: { name: "Carrazeda de Ansi√£es", lat: 41.2667, lng: -7.4833, type: "aldea hist√≥rica" },
            ali_jo: { name: "Alij√≥", lat: 41.2833, lng: -7.5667, type: "pueblo del vino" },
            covilha: { name: "Covilh√£", lat: 40.2833, lng: -7.5000, type: "ciudad hist√≥rica" },
            seia: { name: "Seia", lat: 40.4833, lng: -7.7333, type: "pueblo serrano" },
            gouveia: { name: "Gouveia", lat: 40.5167, lng: -7.7667, type: "pueblo serrano" },
            manteigas: { name: "Manteigas", lat: 40.3667, lng: -7.5833, type: "pueblo serrano" },
            sabugal: { name: "Sabugal", lat: 40.3333, lng: -7.0667, type: "ciudad fortificada" },
            almeida: { name: "Almeida", lat: 40.7167, lng: -6.9167, type: "ciudad fortificada" },
            castelo_branco: { name: "Castelo Branco", lat: 39.8236, lng: -7.4931, type: "ciudad hist√≥rica" },
            idanh√£: { name: "Idanha-a-Velha", lat: 40.0167, lng: -7.3167, type: "aldea hist√≥rica" },
            fundao: { name: "Fund√£o", lat: 40.1333, lng: -7.5000, type: "ciudad hist√≥rica" },
            oliveira_frares: { name: "Oliveira de Frades", lat: 40.7667, lng: -8.1333, type: "pueblo hist√≥rico" },
            sao_pedro_sul: { name: "S√£o Pedro do Sul", lat: 40.7833, lng: -8.0167, type: "ciudad termal" },
            luso: { name: "Luso", lat: 40.3667, lng: -8.3167, type: "balneario termal" },
            curia: { name: "Curia", lat: 40.4167, lng: -8.4833, type: "balneario termal" },
            mealhada: { name: "Mealhada", lat: 40.5333, lng: -8.5167, type: "pueblo del vino" },
            cantanhede: { name: "Cantanhede", lat: 40.3500, lng: -8.5833, type: "pueblo hist√≥rico" },
            montemor_velho: { name: "Montemor-o-Velho", lat: 40.1667, lng: -8.6833, type: "pueblo hist√≥rico" },
            figueira_foz: { name: "Figueira da Foz", lat: 40.1528, lng: -8.8583, type: "pueblo costero" },
            miranda_corvo: { name: "Miranda do Corvo", lat: 40.1333, lng: -8.3333, type: "pueblo hist√≥rico" },
            penela: { name: "Penela", lat: 40.1333, lng: -8.3667, type: "aldea hist√≥rica" },
            ansiao: { name: "Ansi√£o", lat: 39.9167, lng: -8.4167, type: "pueblo hist√≥rico" },
            leiria: { name: "Leiria", lat: 39.7431, lng: -8.8069, type: "ciudad hist√≥rica" },
            batalha: { name: "Batalha", lat: 39.6567, lng: -8.8181, type: "patrimonio UNESCO" },
            alcobaca: { name: "Alcoba√ßa", lat: 39.5531, lng: -8.9758, type: "patrimonio UNESCO" },
            alenquer: { name: "Alenquer", lat: 39.1667, lng: -9.0167, type: "pueblo hist√≥rico" },
            torres_vedras: { name: "Torres Vedras", lat: 39.0931, lng: -9.2628, type: "ciudad hist√≥rica" },
            caldas_rainha: { name: "Caldas da Rainha", lat: 39.4031, lng: -9.1333, type: "ciudad termal" },
            bombarral: { name: "Bombarral", lat: 39.2833, lng: -9.1500, type: "pueblo hist√≥rico" },
            lourinha: { name: "Lourinh√£", lat: 39.2500, lng: -9.3333, type: "pueblo hist√≥rico" },
            atouguia_baleia: { name: "Atouguia da Baleia", lat: 39.3833, lng: -9.3500, type: "pueblo hist√≥rico" },
            peniche: { name: "Peniche", lat: 39.3667, lng: -9.3833, type: "pueblo pesquero" },
            obidos: { name: "√ìbidos", lat: 39.3583, lng: -9.1569, type: "pueblo medieval" },
            caldas_nova: { name: "Caldas da Rainha", lat: 39.4031, lng: -9.1333, type: "ciudad termal" },
            bombarral: { name: "Bombarral", lat: 39.2833, lng: -9.1500, type: "pueblo hist√≥rico" },
            lourinha: { name: "Lourinh√£", lat: 39.2500, lng: -9.3333, type: "pueblo hist√≥rico" },
            atouguia_baleia: { name: "Atouguia da Baleia", lat: 39.3833, lng: -9.3500, type: "pueblo hist√≥rico" },
            peniche: { name: "Peniche", lat: 39.3667, lng: -9.3833, type: "pueblo pesquero" },
            nazare: { name: "Nazar√©", lat: 39.6053, lng: -9.0722, type: "pueblo pesquero" },
            sao_martinho_touros: { name: "S√£o Martinho do Porto", lat: 39.6000, lng: -9.1000, type: "playa" },
            alcobaca: { name: "Alcoba√ßa", lat: 39.5531, lng: -8.9758, type: "patrimonio UNESCO" },
            batalha: { name: "Batalha", lat: 39.6567, lng: -8.8181, type: "patrimonio UNESCO" },
            leiria: { name: "Leiria", lat: 39.7431, lng: -8.8069, type: "ciudad hist√≥rica" },
            marinha_grande: { name: "Marinha Grande", lat: 39.7500, lng: -8.9167, type: "ciudad industrial" },
            figueira_foz: { name: "Figueira da Foz", lat: 40.1528, lng: -8.8583, type: "pueblo costero" }
        };

        // Base de datos de actividades por ciudad
        const activities = {
            lisboa: {
                cultural: [
                    { name: "Torre de Bel√©m", description: "Patrimonio de la Humanidad. Construida en el siglo XVI como torre de defensa con estilo manuelino √∫nico.", category: "Monumento Hist√≥rico" },
                    { name: "Monasterio de los Jer√≥nimos", description: "Arquitectura manuelina impresionante del siglo XVI. Tumbas de Vasco da Gama y Lu√≠s de Cam√µes.", category: "Monasterio" },
                    { name: "Castillo de San Jorge", description: "Fortaleza mora del siglo VIII con vistas panor√°micas espectaculares sobre Lisboa y el Tajo.", category: "Castillo" }
                ],
                restaurants: [
                    { name: "Cervejaria Ramiro", description: "Famoso por mariscos frescos desde 1956. Especialidad en percebes y gambas gigantes.", phone: "+351 21 885 1024", price: "‚Ç¨‚Ç¨‚Ç¨" },
                    { name: "Time Out Market", description: "Mercado gastron√≥mico con m√∫ltiples opciones. Perfecto para probar diferentes platos portugueses.", phone: "+351 21 346 0886", price: "‚Ç¨‚Ç¨" },
                    { name: "Belcanto", description: "Dos estrellas Michelin. Cocina portuguesa contempor√°nea del chef Jos√© Avillez.", phone: "+351 21 342 0607", price: "‚Ç¨‚Ç¨‚Ç¨‚Ç¨" }
                ]
            },
            porto: {
                cultural: [
                    { name: "Torre de los Cl√©rigos", description: "S√≠mbolo de Oporto. Sube 240 escalones para vistas panor√°micas de toda la ciudad.", category: "Torre Hist√≥rica" },
                    { name: "Catedral de Oporto", description: "Arquitectura rom√°nica y g√≥tica. La m√°s importante del norte de Portugal con vistas al Duero.", category: "Catedral" },
                    { name: "Livraria Lello", description: "Una de las librer√≠as m√°s bellas del mundo. Inspiraci√≥n de J.K. Rowling para Harry Potter.", category: "Librer√≠a Hist√≥rica" }
                ],
                restaurants: [
                    { name: "Cantinho do Avillez", description: "Cocina portuguesa moderna del famoso chef Jos√© Avillez. Ambiente elegante.", phone: "+351 22 013 1350", price: "‚Ç¨‚Ç¨‚Ç¨" },
                    { name: "Majestic Caf√©", description: "Caf√© hist√≥rico art nouveau desde 1921. Perfecto para un caf√© o tosta.", phone: "+351 22 200 3927", price: "‚Ç¨‚Ç¨" },
                    { name: "Caf√© Santiago", description: "Famoso por el mejor 'Francesinha' de Oporto. S√°ndwich con carne y salsa especial.", phone: "+351 22 200 6185", price: "‚Ç¨" }
                ]
            },
            coimbra: {
                cultural: [
                    { name: "Universidad de Coimbra", description: "Una de las m√°s antiguas del mundo (1290). Patrimonio de la Humanidad UNESCO.", category: "Universidad Hist√≥rica" },
                    { name: "Biblioteca Joanina", description: "Biblioteca barroca del siglo XVIII con m√°s de 200,000 vol√∫menes antiguos y decoraci√≥n en oro.", category: "Biblioteca" },
                    { name: "Catedral Nueva", description: "Arquitectura renacentista y barroca. La catedral m√°s importante de Coimbra.", category: "Catedral" }
                ],
                restaurants: [
                    { name: "Z√© Manel dos Ossos", description: "Cocina tradicional portuguesa en ambiente r√∫stico. Especialidad en carnes y vinos.", phone: "+351 23 982 5935", price: "‚Ç¨‚Ç¨" },
                    { name: "√Ä Capa", description: "Restaurante moderno con vistas panor√°micas sobre el r√≠o Mondego.", phone: "+351 23 970 0440", price: "‚Ç¨‚Ç¨‚Ç¨" },
                    { name: "Pastel de Santa Clara", description: "Pasteler√≠a tradicional famosa por sus 'Past√©is de Santa Clara'.", phone: "+351 23 982 7733", price: "‚Ç¨" }
                ]
            },
            braga: {
                cultural: [
                    { name: "Santuario del Bom Jes√∫s", description: "Escaleras barrocas monumentales con capillas. Sube a pie o en funicular hist√≥rico de 1882.", category: "Santuario" },
                    { name: "Catedral de Braga", description: "La catedral m√°s antigua de Portugal (siglo XII). Museo tesoro con piezas √∫nicas.", category: "Catedral" },
                    { name: "Castillo de Braga", description: "Ruinas hist√≥ricas en el centro. Torre de Menagem con vistas panor√°micas.", category: "Castillo" }
                ],
                restaurants: [
                    { name: "Taberna Belga", description: "Cocina tradicional minhota. Especialidad en 'Cabrito assado' (cabrito asado).", phone: "+351 25 326 1660", price: "‚Ç¨‚Ç¨" },
                    { name: "S√≠lvia & C√©u", description: "Restaurante familiar aut√©ntico con platos generosos y sabores tradicionales.", phone: "+351 25 327 1030", price: "‚Ç¨‚Ç¨" },
                    { name: "Casa do Arnado", description: "Tasca tradicional con ambiente local. Perfecto para petiscos y vinos verde.", phone: "+351 25 327 3333", price: "‚Ç¨" }
                ]
            },
            aveiro: {
                cultural: [
                    { name: "Paseo en Moliceiro", description: "Barco tradicional colorido por los canales. Similar a las g√≥ndolas de Venecia.", category: "Experiencia" },
                    { name: "Museo de Aveiro", description: "Arte sacro y azulejos en antiguo convento. Tumba de la princesa Santa Joana.", category: "Museo" },
                    { name: "Canal de Aveiro", description: "Venecia portuguesa con casas coloridas y puentes pintorescos.", category: "Arquitectura" }
                ],
                restaurants: [
                    { name: "O Caminho das Areias", description: "Mariscos frescos del canal en ambiente r√∫stico. Especialidad en arroz de marisco.", phone: "+351 23 431 5555", price: "‚Ç¨‚Ç¨" },
                    { name: "Restaurante Costa Nova", description: "Cocina del mar tradicional en la playa. Pescado fresco a la brasa.", phone: "+351 23 437 8888", price: "‚Ç¨‚Ç¨‚Ç¨" },
                    { name: "Ovos Moles", description: "Dulces tradicionales de Aveiro: yema y az√∫car envueltos en oblea.", phone: "+351 23 431 2222", price: "‚Ç¨" }
                ]
            },
            faro: {
                cultural: [
                    { name: "Catedral de Faro", description: "Arquitectura variada hist√≥rica desde el siglo XIII. Vistas panor√°micas desde la torre.", category: "Catedral" },
                    { name: "Museo Arqueol√≥gico", description: "Historia romana y portuguesa. Restos romanos y arte sacro en antiguo convento.", category: "Museo" },
                    { name: "Arco de la Puerta del Mar", description: "Entrada hist√≥rica a la ciudad amurallada. S√≠mbolo de Faro desde el siglo XIX.", category: "Monumento" }
                ],
                restaurants: [
                    { name: "Restaurante O Castelo", description: "Vistas al castillo y cocina algarvia tradicional. Especialidad en pescados.", phone: "+351 28 981 5555", price: "‚Ç¨‚Ç¨‚Ç¨" },
                    { name: "Marisqueira Faro", description: "Mariscos frescos del Atl√°ntico en ambiente tradicional. Recomendado el arroz de marisco.", phone: "+351 28 982 3333", price: "‚Ç¨‚Ç¨" },
                    { name: "O Pescador", description: "Pescado fresco a la brasa en el puerto pesquero. Ambiente sencillo y aut√©ntico.", phone: "+351 28 982 9999", price: "‚Ç¨‚Ç¨" }
                ]
            },
            evora: {
                cultural: [
                    { name: "Templo Romano", description: "Ruinas romanas impresionantes del siglo I. S√≠mbolo de √âvora y Patrimonio de la Humanidad.", category: "Ruinas Romanas" },
                    { name: "Capilla de los Huesos", description: "Capilla √∫nica con paredes decoradas con huesos humanos. Mensaje reflexivo sobre la vida.", category: "Capilla" },
                    { name: "Catedral de √âvora", description: "Arquitectura g√≥tica monumental del siglo XIII. Claustro y azulejos impresionantes.", category: "Catedral" }
                ],
                restaurants: [
                    { name: "Fialho", description: "Restaurante hist√≥rico desde 1961. Referencia de la cocina alentejana con ambiente elegante.", phone: "+351 26 678 7060", price: "‚Ç¨‚Ç¨‚Ç¨" },
                    { name: "Tasquinha do Oliveira", description: "Cocina tradicional alentejana en ambiente r√∫stico. Especialidad en carnes de caza.", phone: "+351 26 678 8888", price: "‚Ç¨‚Ç¨" },
                    { name: "Taberna de Portalegre", description: "Vinos y tapas locales en tasca tradicional. Perfecto para probar el vino del Alentejo.", phone: "+351 26 678 9999", price: "‚Ç¨‚Ç¨" }
                ]
            },
            setubal: {
                cultural: [
                    { name: "Castillo de San Felipe", description: "Fortaleza hist√≥rica con vistas al estuario del Sado y la costa. Construido en el siglo XV.", category: "Castillo" },
                    { name: "Convento de Jes√∫s", description: "Arquitectura manuelina y renacentista. Museo de arte sacro y azulejos antiguos.", category: "Convento" },
                    { name: "Mercado del Puerto", description: "Mercado tradicional animado con pescado fresco y ambiente local aut√©ntico.", category: "Mercado" }
                ],
                restaurants: [
                    { name: "Restaurante Ramiro", description: "Mariscos frescos del Sado en ambiente tradicional. Especialidad en chocos fritos.", phone: "+351 26 552 3333", price: "‚Ç¨‚Ç¨‚Ç¨" },
                    { name: "Marisqueira do Pescador", description: "Especialidades del d√≠a en el puerto pesquero. Pescado fresco a precios razonables.", phone: "+351 26 552 7777", price: "‚Ç¨‚Ç¨" },
                    { name: "Adega da Marina", description: "Tasca tradicional con ambiente marinero. Chocos fritos y vinos de Set√∫bal.", phone: "+351 26 552 8888", price: "‚Ç¨" }
                ]
            },
            sintra: {
                cultural: [
                    { name: "Palacio Nacional de Sintra", description: "Palacio rom√°ntico con chimeneas c√≥nicas √∫nicas. Residencia real durante siglos.", category: "Palacio" },
                    { name: "Quinta da Regaleira", description: "Jardines m√≠sticos, pozos inici√°ticos y grutas. Simbolismo mas√≥nico y alquimista.", category: "Quinta" },
                    { name: "Castillo de los Moros", description: "Ruinas medievales con vistas panor√°micas sobre Sintra y el oc√©ano.", category: "Castillo" }
                ],
                restaurants: [
                    { name: "Tascantiga", description: "Tasca tradicional con ambiente r√∫stico. Petiscos y vinos locales en el centro de Sintra.", phone: "+351 21 923 4444", price: "‚Ç¨‚Ç¨" },
                    { name: "Inate", description: "Cocina contempor√°nea creativa en edificio hist√≥rico. Men√∫s degustaci√≥n innovadores.", phone: "+351 21 923 5555", price: "‚Ç¨‚Ç¨‚Ç¨" },
                    { name: "Pastel de Sintra", description: "Pasteles tradicionales locales: hojaldre con crema pastelera y canela.", phone: "+351 21 923 6666", price: "‚Ç¨" }
                ]
            },
            obidos: {
                cultural: [
                    { name: "Castillo de √ìbidos", description: "Castillo medieval amurallado del siglo XII. Se puede caminar por las murallas completas.", category: "Castillo Medieval" },
                    { name: "Iglesia de Santa Mar√≠a", description: "Iglesia g√≥tica dentro del castillo con azulejos del siglo XVIII y √≥rgano barroco.", category: "Iglesia" },
                    { name: "Murallas de √ìbidos", description: "Paseo completo por las murallas medievales con vistas panor√°micas del pueblo y campo.", category: "Murallas" }
                ],
                restaurants: [
                    { name: "Restaurante do Castelo", description: "Comida dentro del castillo con vistas panor√°micas. Ambiente rom√°ntico y cocina tradicional.", phone: "+351 26 295 5555", price: "‚Ç¨‚Ç¨‚Ç¨" },
                    { name: "Tasquinha do Celso", description: "Cocina tradicional en ambiente r√∫stico. Especialidad en bacalao y carnes a la brasa.", phone: "+351 26 295 7777", price: "‚Ç¨‚Ç¨" },
                    { name: "Ginjinha de √ìbidos", description: "Licor tradicional de guindas servido en copa de chocolate. ¬°No te lo pierdas!", phone: "+351 26 295 8888", price: "‚Ç¨" }
                ]
            },
            nazare: {
                cultural: [
                    { name: "Santuario de Nuestra Se√±ora de Nazar√©", description: "Santuario religioso importante con leyenda de la aparici√≥n de la Virgen a un pescador.", category: "Santuario" },
                    { name: "Forte de S√£o Miguel Arcanjo", description: "Fuerte hist√≥rico con vistas espectaculares. En invierno se ven las olas gigantes desde aqu√≠.", category: "Fortaleza" },
                    { name: "Museo Dr. Joaquim Manso", description: "Historia y cultura local. Trajes tradicionales de las pescadoras de Nazar√©.", category: "Museo" }
                ],
                restaurants: [
                    { name: "Restaurante A Tasquinha", description: "Pescado fresco y sardinas asadas en ambiente tradicional. Especialidad local.", phone: "+351 26 256 3333", price: "‚Ç¨‚Ç¨" },
                    { name: "O Celeiro", description: "Mariscos y vistas al mar. Terraza con vistas espectaculares sobre el oc√©ano.", phone: "+351 26 256 4444", price: "‚Ç¨‚Ç¨‚Ç¨" },
                    { name: "Pastel de Tent√∫gal", description: "Pasteles tradicionales: hojaldre fino relleno de crema. Delicadeza regional.", phone: "+351 26 256 5555", price: "‚Ç¨" }
                ]
            },
            fatima: {
                cultural: [
                    { name: "Santuario de F√°tima", description: "Centro de peregrinaci√≥n mundial. Capilla de las Apariciones y Bas√≠lica de Nuestra Se√±ora del Rosario.", category: "Santuario" },
                    { name: "Capilla de las Apariciones", description: "Lugar exacto de las apariciones marianas a tres pastorcitos en 1917.", category: "Capilla" },
                    { name: "Basilica de la Sant√≠sima Trinidad", description: "Arquitectura moderna monumental. Una de las iglesias cat√≥licas m√°s grandes del mundo.", category: "Bas√≠lica" }
                ],
                restaurants: [
                    { name: "Restaurante do Santu√°rio", description: "Comida cerca del santuario. Men√∫s econ√≥micos para peregrinos y visitantes.", phone: "+351 24 953 5555", price: "‚Ç¨‚Ç¨" },
                    { name: "Adega do Povo", description: "Cocina tradicional beirense en ambiente r√∫stico. Especialidad en carnes y vinos locales.", phone: "+351 24 953 6666", price: "‚Ç¨‚Ç¨" },
                    { name: "Pastel de F√°tima", description: "Pasteles locales: hojaldre con crema pastelera. Tradici√≥n desde hace generaciones.", phone: "+351 24 953 7777", price: "‚Ç¨" }
                ]
            },
            tomar: {
                cultural: [
                    { name: "Convento de Cristo", description: "Patrimonio de la Humanidad templario. Iglesia Charola inspirada en el Santo Sepulcro de Jerusal√©n.", category: "Convento Templario" },
                    { name: "Castillo de Tomar", description: "Fortaleza templaria hist√≥rica del siglo XII. Fundada por Gualdim Pais, Gran Maestre de los Templarios.", category: "Castillo" },
                    { name: "Sinagoga de Tomar", description: "√önica sinagoga medieval de Portugal bien conservada. Museo Luso-Hebraico.", category: "Sinagoga" }
                ],
                restaurants: [
                    { name: "Restaurante Sabores do Tempo", description: "Cocina tradicional con historia. Platos que recrean recetas antiguas templarias.", phone: "+351 24 931 5555", price: "‚Ç¨‚Ç¨" },
                    { name: "Taberna do Z√©", description: "Tasca familiar aut√©ntica. Petiscos y vinos de la regi√≥n a precios razonables.", phone: "+351 24 931 6666", price: "‚Ç¨‚Ç¨" },
                    { name: "Pastel de Tomar", description: "Dulce tradicional local: hojaldre con crema pastelera y yema. Especialidad de la ciudad.", phone: "+351 24 931 7777", price: "‚Ç¨" }
                ]
            },
            guimaraes: {
                cultural: [
                    { name: "Castillo de Guimar√£es", description: "Cuna de Portugal hist√≥rico. Castillo del siglo X donde naci√≥ el primer rey de Portugal.", category: "Castillo" },
                    { name: "Palacio de los Duques", description: "Palacio g√≥tico monumental del siglo XV. Residencia de los duques de Braganza.", category: "Palacio" },
                    { name: "Centro Hist√≥rico", description: "Patrimonio de la Humanidad UNESCO. Calles medievales, plazas y arquitectura tradicional.", category: "Casco Hist√≥rico" }
                ],
                restaurants: [
                    { name: "Restaurante Santiago", description: "Cocina tradicional minhota en edificio hist√≥rico. Especialidad en cabrito y postres conventuales.", phone: "+351 25 341 5555", price: "‚Ç¨‚Ç¨" },
                    { name: "Cantinho dos Sabores", description: "Platos t√≠picos locales en ambiente acogedor. Bacalao y carnes a la brasa recomendados.", phone: "+351 25 341 6666", price: "‚Ç¨‚Ç¨" },
                    { name: "Pastel de Guimar√£es", description: "Dulce tradicional: hojaldre con crema pastelera y yema. Especialidad local.", phone: "+351 25 341 7777", price: "‚Ç¨" }
                ]
            },
            viseu: {
                cultural: [
                    { name: "Catedral de Viseu", description: "Arquitectura g√≥tica y renacentista. Impresionante claustro y pinturas de Gr√£o Vasco.", category: "Catedral" },
                    { name: "Museo Gr√£o Vasco", description: "Colecci√≥n de pinturas del siglo XVI del famoso pintor portugu√©s Gr√£o Vasco.", category: "Museo" },
                    { name: "Centro Hist√≥rico", description: "Calles empedradas y plazas medievales. Ambiente tranquilo y aut√©ntico.", category: "Casco Hist√≥rico" }
                ],
                restaurants: [
                    { name: "Restaurante O P√°tio", description: "Cocina tradicional beirense en patio interior. Ambiente tranquilo y acogedor.", phone: "+351 23 242 5555", price: "‚Ç¨‚Ç¨" },
                    { name: "Taberna do Largo", description: "Tasca tradicional en la plaza principal. Petiscos y vinos de la regi√≥n D√£o.", phone: "+351 23 242 6666", price: "‚Ç¨‚Ç¨" },
                    { name: "Pastel de Viseu", description: "Pasteles tradicionales locales. Especialidad de la regi√≥n.", phone: "+351 23 242 7777", price: "‚Ç¨" }
                ]
            },
            guarda: {
                cultural: [
                    { name: "Catedral de Guarda", description: "√önica catedral g√≥tica de Portugal construida en el siglo XVI. Impresionante fachada y claustro.", category: "Catedral" },
                    { name: "Castillo de Guarda", description: "Castillo medieval con vistas panor√°micas sobre la ciudad y la Serra da Estrela.", category: "Castillo" },
                    { name: "Jard√≠n del Castillo", description: "Jardines hist√≥ricos con vistas espectaculares. Perfecto para pasear y relajarse.", category: "Jard√≠n" }
                ],
                restaurants: [
                    { name: "Restaurante O Miradouro", description: "Vistas panor√°micas sobre la ciudad. Cocina tradicional de la Beira Alta.", phone: "+351 27 127 5555", price: "‚Ç¨‚Ç¨" },
                    { name: "Taberna da S√©", description: "Tasca tradicional cerca de la catedral. Platos caseros y vinos de la regi√≥n.", phone: "+351 27 127 6666", price: "‚Ç¨‚Ç¨" },
                    { name: "Caf√© Guarda", description: "Caf√© hist√≥rico en el centro. Perfecto para tomar un caf√© despu√©s de visitar la catedral.", phone: "+351 27 127 7777", price: "‚Ç¨" }
                ]
            },
            cascais: {
                cultural: [
                    { name: "Boca do Inferno", description: "Formaci√≥n rocosa dram√°tica donde el oc√©ano choca contra los acantilados. Vistas espectaculares.", category: "Formaci√≥n Natural" },
                    { name: "Palacio de los Condes de Castro Guimar√£es", description: "Palacio hist√≥rico con museo y vistas al oc√©ano. Arquitectura ecl√©ctica √∫nica.", category: "Palacio" },
                    { name: "Cascais Marina", description: "Puerto deportivo con ambiente animado. Restaurantes y tiendas junto al mar.", category: "Puerto" }
                ],
                restaurants: [
                    { name: "Restaurante Furnas do Guincho", description: "Restaurante gourmet con vistas al oc√©ano. Especialidad en mariscos y pescados.", phone: "+351 21 487 3100", price: "‚Ç¨‚Ç¨‚Ç¨‚Ç¨" },
                    { name: "Mar do Inferno", description: "Restaurante con vistas a la Boca do Inferno. Pescado fresco y ambiente rom√°ntico.", phone: "+351 21 488 5555", price: "‚Ç¨‚Ç¨‚Ç¨" },
                    { name: "O Pescador", description: "Pescado fresco en el puerto pesquero. Ambiente sencillo y aut√©ntico.", phone: "+351 21 482 6666", price: "‚Ç¨‚Ç¨" }
                ]
            },
            sesimbra: {
                cultural: [
                    { name: "Castillo de Sesimbra", description: "Castillo medieval con vistas panor√°micas sobre el pueblo y el oc√©ano Atl√°ntico.", category: "Castillo" },
                    { name: "Playa de Sesimbra", description: "Playa de arena dorada protegida por el castillo. Aguas cristalinas y ambiente familiar.", category: "Playa" },
                    { name: "Puerto Pesquero", description: "Puerto tradicional con barcos de pesca. Mercado de pescado fresco diario.", category: "Puerto" }
                ],
                restaurants: [
                    { name: "Restaurante O Pescador", description: "Pescado fresco en el puerto. Especialidad en arroz de marisco y pescado a la brasa.", phone: "+351 23 228 5555", price: "‚Ç¨‚Ç¨" },
                    { name: "Marisqueira Sesimbra", description: "Mariscos frescos del Atl√°ntico. Ambiente tradicional y precios razonables.", phone: "+351 23 228 6666", price: "‚Ç¨‚Ç¨" },
                    { name: "Restaurante do Castelo", description: "Comida con vistas al castillo y el oc√©ano. Ambiente rom√°ntico y cocina tradicional.", phone: "+351 23 228 7777", price: "‚Ç¨‚Ç¨‚Ç¨" }
                ]
            },
            peniche: {
                cultural: [
                    { name: "Fortaleza de Peniche", description: "Fortaleza hist√≥rica construida en el siglo XVI. Museo y prisi√≥n pol√≠tica durante el Estado Novo.", category: "Fortaleza" },
                    { name: "Playa de Peniche", description: "Famosa por el surf de olas grandes. Playas extensas de arena dorada.", category: "Playa" },
                    { name: "Cabo Carvoeiro", description: "Punto m√°s occidental de Peniche con faro y vistas espectaculares sobre el Atl√°ntico.", category: "Cabo" }
                ],
                restaurants: [
                    { name: "Restaurante O Pescador", description: "Pescado fresco en el puerto pesquero. Especialidad en mariscos y pescados locales.", phone: "+351 26 278 5555", price: "‚Ç¨‚Ç¨" },
                    { name: "Marisqueira Peniche", description: "Mariscos frescos del Atl√°ntico. Ambiente tradicional y precios razonables.", phone: "+351 26 278 6666", price: "‚Ç¨‚Ç¨" },
                    { name: "Restaurante do Porto", description: "Comida con vistas al puerto. Ambiente acogedor y cocina tradicional.", phone: "+351 26 278 7777", price: "‚Ç¨‚Ç¨" }
                ]
            },
            batalha: {
                cultural: [
                    { name: "Monasterio de Batalha", description: "Patrimonio de la Humanidad UNESCO. Construido para conmemorar la batalla de Aljubarrota (1385).", category: "Monasterio" },
                    { name: "Capilla del Fundador", description: "Capilla funeraria de Juan I de Portugal y su esposa. Impresionante arquitectura g√≥tica.", category: "Capilla" },
                    { name: "Claustro de D. Jo√£o I", description: "Claustro g√≥tico monumental con arcos ojivales y decoraci√≥n manuelina.", category: "Claustro" }
                ],
                restaurants: [
                    { name: "Restaurante O Mosteiro", description: "Cocina tradicional cerca del monasterio. Especialidad en cabrito y postres conventuales.", phone: "+351 24 481 5555", price: "‚Ç¨‚Ç¨" },
                    { name: "Taberna da Batalha", description: "Tasca tradicional en el centro. Petiscos y vinos de la regi√≥n.", phone: "+351 24 481 6666", price: "‚Ç¨‚Ç¨" },
                    { name: "Caf√© Batalha", description: "Caf√© hist√≥rico en la plaza principal. Perfecto para tomar un caf√© despu√©s de visitar el monasterio.", phone: "+351 24 481 7777", price: "‚Ç¨" }
                ]
            },
            alcobaca: {
                cultural: [
                    { name: "Monasterio de Alcoba√ßa", description: "Patrimonio de la Humanidad UNESCO. Uno de los primeros edificios g√≥ticos de Portugal.", category: "Monasterio" },
                    { name: "Tumbas de Pedro y In√™s", description: "Tumbas monumentales del rey Pedro I y Do√±a In√™s de Castro. Leyenda de amor tr√°gico.", category: "Tumbas Hist√≥ricas" },
                    { name: "Claustro del Silencio", description: "Claustro cisterciense impresionante con fuentes y arquer√≠as g√≥ticas.", category: "Claustro" }
                ],
                restaurants: [
                    { name: "Restaurante O Mosteiro", description: "Cocina tradicional cerca del monasterio. Especialidad en cabrito y postres conventuales.", phone: "+351 26 259 5555", price: "‚Ç¨‚Ç¨" },
                    { name: "Taberna de Alcoba√ßa", description: "Tasca tradicional en el centro. Petiscos y vinos de la regi√≥n.", phone: "+351 26 259 6666", price: "‚Ç¨‚Ç¨" },
                    { name: "Pastel de Alcoba√ßa", description: "Pasteles tradicionales locales. Especialidad de la regi√≥n.", phone: "+351 26 259 7777", price: "‚Ç¨" }
                ]
            }
        };

        let map;
        let markers = [];
        let currentSelectedPoint = 0;
        let routeData = null;

        // Inicializar el mapa
        function initMap() {
            map = L.map('map').setView([39.5, -8.0], 7);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
        }

        // Calcular distancia entre dos puntos (f√≥rmula Haversine)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radio de la Tierra en km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            const distance = R * c;
            return Math.round(distance);
        }

        // Obtener paradas relevantes entre origen y destino
        function getRelevantStops(startCity, endCity) {
            const startCoords = cities[startCity];
            const endCoords = cities[endCity];
            
            // Filtrar ciudades que est√°n aproximadamente entre origen y destino
            const relevantStops = Object.keys(cities)
                .filter(city => city !== startCity && city !== endCity)
                .map(city => {
                    const cityData = cities[city];
                    const distanceToStart = calculateDistance(
                        startCoords.lat, startCoords.lng,
                        cityData.lat, cityData.lng
                    );
                    const distanceToEnd = calculateDistance(
                        endCoords.lat, endCoords.lng,
                        cityData.lat, cityData.lng
                    );
                    const directDistance = calculateDistance(
                        startCoords.lat, startCoords.lng,
                        endCoords.lat, endCoords.lng
                    );
                    
                    // Calcular qu√© tan "fuera de camino" est√° (0 = en el camino perfecto)
                    const detourFactor = (distanceToStart + distanceToEnd) / directDistance;
                    
                    return {
                        key: city,
                        data: cityData,
                        detourFactor: detourFactor,
                        totalDistance: distanceToStart + distanceToEnd
                    };
                })
                .filter(stop => stop.detourFactor <= 1.8) // M√°ximo 80% de desv√≠o
                .sort((a, b) => a.detourFactor - b.detourFactor)
                .slice(0, 10); // M√°ximo 10 paradas
            
            return relevantStops;
        }

        // Llenar el dropdown de paradas intermedias
        function fillMiddleStops(startCity, endCity) {
            const middleStopSelect = document.getElementById('middleStop');
            middleStopSelect.innerHTML = '<option value="">Sin parada intermedia</option>';
            
            if (!startCity || !endCity) return;
            
            const relevantStops = getRelevantStops(startCity, endCity);
            
            relevantStops.forEach(stop => {
                const option = document.createElement('option');
                option.value = stop.key;
                option.textContent = `${stop.data.name} (${stop.data.type})`;
                middleStopSelect.appendChild(option);
            });
        }

        // Generar ruta y mostrar resultados
        function generateRoute() {
            const startPoint = document.getElementById('startPoint').value;
            const endPoint = document.getElementById('endPoint').value;
            
            if (!startPoint || !endPoint) {
                alert('Por favor, selecciona ciudad de salida y llegada');
                return;
            }

            if (startPoint === endPoint) {
                alert('La ciudad de salida y llegada no pueden ser la misma');
                return;
            }

            const middleStop = document.getElementById('middleStop').value;
            
            // Limpiar marcadores anteriores
            markers.forEach(marker => marker.remove());
            markers = [];

            // Obtener coordenadas
            const startCoords = cities[startPoint];
            const endCoords = cities[endPoint];
            const middleCoords = middleStop ? cities[middleStop] : null;

            // Calcular distancias
            let distance1 = 0;
            let distance2 = 0;
            let totalDistance = 0;

            if (middleStop) {
                distance1 = calculateDistance(
                    startCoords.lat, startCoords.lng,
                    middleCoords.lat, middleCoords.lng
                );
                distance2 = calculateDistance(
                    middleCoords.lat, middleCoords.lng,
                    endCoords.lat, endCoords.lng
                );
                totalDistance = distance1 + distance2;
            } else {
                distance1 = calculateDistance(
                    startCoords.lat, startCoords.lng,
                    endCoords.lat, endCoords.lng
                );
                totalDistance = distance1;
            }

            // Guardar datos de la ruta
            routeData = {
                start: startPoint,
                middle: middleStop,
                end: endPoint,
                distance1: distance1,
                distance2: distance2,
                total: totalDistance
            };

            // Mostrar informaci√≥n en el resumen
            document.getElementById('nameStart').textContent = startCoords.name;
            document.getElementById('nameEnd').textContent = endCoords.name;
            
            if (middleStop) {
                document.getElementById('nameMiddle').textContent = middleCoords.name;
                document.getElementById('distance1').textContent = `${distance1} km`;
                document.getElementById('distance2').textContent = `${distance2} km`;
                document.getElementById('pointMiddle').style.display = 'flex';
                document.getElementById('distance2').style.display = 'block';
            } else {
                document.getElementById('nameMiddle').textContent = '-';
                document.getElementById('distance1').textContent = `${distance1} km`;
                document.getElementById('distance2').style.display = 'none';
                document.getElementById('pointMiddle').style.display = 'none';
            }

            // Agregar marcadores al mapa
            const startMarker = L.marker([startCoords.lat, startCoords.lng], {
                icon: L.divIcon({
                    html: '<div style="background:#667eea;color:white;width:35px;height:35px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:16px;border:3px solid white;box-shadow:0 4px 8px rgba(0,0,0,0.3);">1</div>',
                    className: '',
                    iconSize: [35, 35]
                })
            }).addTo(map).bindPopup(`<b>üìç Salida:</b> ${startCoords.name}`);
            markers.push(startMarker);

            if (middleStop) {
                const middleMarker = L.marker([middleCoords.lat, middleCoords.lng], {
                    icon: L.divIcon({
                        html: '<div style="background:#f093fb;color:white;width:35px;height:35px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:16px;border:3px solid white;box-shadow:0 4px 8px rgba(0,0,0,0.3);">2</div>',
                        className: '',
                        iconSize: [35, 35]
                    })
                }).addTo(map).bindPopup(`<b>üè® Parada:</b> ${middleCoords.name}`);
                markers.push(middleMarker);
            }

            const endMarker = L.marker([endCoords.lat, endCoords.lng], {
                icon: L.divIcon({
                    html: '<div style="background:#4facfe;color:white;width:35px;height:35px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:16px;border:3px solid white;box-shadow:0 4px 8px rgba(0,0,0,0.3);">3</div>',
                    className: '',
                    iconSize: [35, 35]
                })
            }).addTo(map).bindPopup(`<b>üèÅ Llegada:</b> ${endCoords.name}`);
            markers.push(endMarker);

            // Centrar el mapa
            if (middleStop) {
                map.fitBounds([
                    [Math.min(startCoords.lat, middleCoords.lat, endCoords.lat) - 0.3, 
                     Math.min(startCoords.lng, middleCoords.lng, endCoords.lng) - 0.3],
                    [Math.max(startCoords.lat, middleCoords.lat, endCoords.lat) + 0.3, 
                     Math.max(startCoords.lng, middleCoords.lng, endCoords.lng) + 0.3]
                ]);
            } else {
                map.fitBounds([
                    [Math.min(startCoords.lat, endCoords.lat) - 0.3, 
                     Math.min(startCoords.lng, endCoords.lng) - 0.3],
                    [Math.max(startCoords.lat, endCoords.lat) + 0.3, 
                     Math.max(startCoords.lng, endCoords.lng) + 0.3]
                ]);
            }

            // Mostrar secci√≥n de resultados
            document.getElementById('resultsSection').classList.add('active');
            
            // Simular loading
            const loading = document.getElementById('loading');
            const panel = document.getElementById('recommendationsPanel');
            
            loading.classList.add('active');
            panel.classList.remove('active');
            
            setTimeout(() => {
                loading.classList.remove('active');
                panel.classList.add('active');
                showRecommendationsForPoint(0); // Mostrar recomendaciones del punto inicial
            }, 800);
        }

        // Mostrar recomendaciones para un punto espec√≠fico
        function showRecommendationsForPoint(pointIndex) {
            // Remover clase active de todos los puntos
            document.querySelectorAll('.route-point').forEach(point => {
                point.classList.remove('active');
            });
            
            // A√±adir clase active al punto seleccionado
            document.querySelector(`.route-point[data-index="${pointIndex}"]`).classList.add('active');
            
            let cityKey = '';
            let cityName = '';
            
            if (pointIndex === 0) {
                cityKey = routeData.start;
                cityName = cities[cityKey].name;
            } else if (pointIndex === 1) {
                if (!routeData.middle) {
                    // Si no hay parada intermedia, mostrar la de llegada
                    cityKey = routeData.end;
                    cityName = cities[cityKey].name;
                    document.querySelector('.route-point[data-index="2"]').classList.add('active');
                } else {
                    cityKey = routeData.middle;
                    cityName = cities[cityKey].name;
                }
            } else if (pointIndex === 2) {
                cityKey = routeData.end;
                cityName = cities[cityKey].name;
            }
            
            // Actualizar nombre en el panel
            document.getElementById('panelCityName').textContent = cityName;
            
            // Mostrar recomendaciones
            showRecommendations(cityKey);
        }

        // Mostrar recomendaciones de una ciudad
        function showRecommendations(cityKey) {
            const grid = document.getElementById('recommendationsGrid');
            grid.innerHTML = '';
            
            if (!activities[cityKey]) {
                grid.innerHTML = '<p style="text-align: center; padding: 40px; color: #999; font-size: 1.2em;">No hay recomendaciones disponibles para esta ciudad.</p>';
                return;
            }
            
            const cityActivities = activities[cityKey];
            
            // Mostrar actividades culturales
            if (cityActivities.cultural) {
                cityActivities.cultural.slice(0, 3).forEach(activity => {
                    const card = createRecommendationCard(
                        activity.name,
                        activity.description,
                        activity.category,
                        'üé≠',
                        'cultural-card'
                    );
                    grid.appendChild(card);
                });
            }
            
            // Mostrar restaurantes
            if (cityActivities.restaurants) {
                cityActivities.restaurants.slice(0, 3).forEach(restaurant => {
                    const card = createRestaurantCard(
                        restaurant.name,
                        restaurant.description,
                        restaurant.phone,
                        restaurant.price,
                        'üçΩÔ∏è',
                        'restaurant-card'
                    );
                    grid.appendChild(card);
                });
            }
        }

        // Crear tarjeta de recomendaci√≥n cultural
        function createRecommendationCard(title, description, category, icon, className) {
            const card = document.createElement('div');
            card.className = `recommendation-card ${className}`;
            card.innerHTML = `
                <div class="card-front">
                    <div class="card-icon">${icon}</div>
                    <div class="card-title">${title}</div>
                    <div class="card-category">${category}</div>
                </div>
                <div class="card-back">
                    <div class="card-description">${description}</div>
                </div>
            `;
            
            card.addEventListener('click', () => {
                card.classList.toggle('flipped');
            });
            
            return card;
        }

        // Crear tarjeta de restaurante
        function createRestaurantCard(title, description, phone, price, icon, className) {
            const card = document.createElement('div');
            card.className = `recommendation-card ${className}`;
            card.innerHTML = `
                <div class="card-front">
                    <div class="card-icon">${icon}</div>
                    <div class="card-title">${title}</div>
                    <div class="card-category">Restaurante</div>
                </div>
                <div class="card-back">
                    <div class="card-description">${description}</div>
                    <div class="card-contact">
                        <i class="fas fa-phone"></i> ${phone}
                        <button class="copy-btn" onclick="copyPhone('${phone}')">
                            <i class="fas fa-copy"></i> Copiar
                        </button>
                    </div>
                    <div class="card-price">${price}</div>
                </div>
            `;
            
            card.addEventListener('click', () => {
                card.classList.toggle('flipped');
            });
            
            return card;
        }

        // Copiar tel√©fono al portapapeles
        window.copyPhone = function(phone) {
            navigator.clipboard.writeText(phone).then(() => {
                alert('Tel√©fono copiado al portapapeles!');
            });
        };

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            
            // Evento para generar ruta
            document.getElementById('generateRouteBtn').addEventListener('click', generateRoute);
            
            // Eventos para cambiar entre puntos
            document.querySelectorAll('.route-point').forEach(point => {
                point.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    showRecommendationsForPoint(index);
                });
            });
            
            // Eventos para actualizar paradas cuando cambian origen/destino
            document.getElementById('startPoint').addEventListener('change', function() {
                const start = this.value;
                const end = document.getElementById('endPoint').value;
                fillMiddleStops(start, end);
            });
            
            document.getElementById('endPoint').addEventListener('change', function() {
                const start = document.getElementById('startPoint').value;
                const end = this.value;
                fillMiddleStops(start, end);
            });
            
            // Llenar paradas iniciales
            fillMiddleStops('lisboa', 'porto');
        });
    </script>
</body>
</html>
